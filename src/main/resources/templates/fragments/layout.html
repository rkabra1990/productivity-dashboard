<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="en"
      th:with="lang=${#locale.language}">

<head>
    <title th:if="${title} != null" th:text="${title} + ' | ProdDash'">ProdDash</title>
    <title th:unless="${title} != null">ProdDash</title>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Productivity Dashboard - Track your habits, tasks, and time">
    
    <!-- Favicon -->
    <link rel="icon" th:href="@{/images/favicon.ico}" type="image/x-icon">
    
    <!-- Preload critical CSS -->
    <link rel="preload" th:href="@{/css/dark-theme.css}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" th:href="@{/css/dark-theme.css}"></noscript>
</head>

<body>
    <div class="app-container" role="application">
        <!-- Header -->
        <header th:replace="~{fragments/header :: header}"></header>
        
        <!-- Main Content -->
        <main class="main-content" role="main" layout:fragment="content">
            <!-- Content will be inserted here -->
        </main>
        
        <!-- Footer -->
        <footer th:replace="~{fragments/footer :: footer}"></footer>
        
        <!-- Connection Status Indicator -->
        <div id="connectionStatus" class="connection-status" role="status" aria-live="polite" hidden></div>
    </div>
    
    <!-- App Scripts -->
    <script th:inline="javascript">
        // Connection status handling
        function updateConnectionStatus() {
            const statusElement = document.getElementById('connectionStatus');
            
            function setStatus(online) {
                statusElement.textContent = online 
                    ? 'You are now connected to the network.' 
                    : 'You are now offline. Some features may be limited.';
                
                statusElement.hidden = false;
                statusElement.className = 'connection-status ' + (online ? 'online' : 'offline');
                
                // Hide after 5 seconds
                setTimeout(() => {
                    statusElement.hidden = true;
                }, 5000);
            }
            
            // Initial status
            setStatus(navigator.onLine);
            
            // Listen for status changes
            window.addEventListener('online', () => setStatus(true));
            window.addEventListener('offline', () => setStatus(false));
        }
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', updateConnectionStatus);
    </script>
    
    <style>
        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 4px;
            color: white;
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            max-width: 300px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .connection-status:not([hidden]) {
            opacity: 0.95;
            transform: translateY(0);
        }
        
        .connection-status.online { 
            background-color: #4CAF50;
        }
        
        .connection-status.offline { 
            background-color: #f44336;
        }
    </style>
</body>
</html>
